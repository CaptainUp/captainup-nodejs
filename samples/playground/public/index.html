<!-- Captain Up NodeJS SDK Sample App Playground -->
<!DOCTYPE html>
<html>
  <head>
    <!-- Page Title -->
    <title>NodeJS SDK Playground :: Captain Up</title>
    <!-- Meta tags -->
    <meta charset='utf-8'>
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <meta content='width=device-width, width=device-height' name='viewport'>
    <meta content='initial-scale=1.0' name='viewport'>
    <meta content='Captain Up offers game mechanics and social tools for maximizing engagement, retention, virality and monetization in your web and mobile apps' name='description'>
    <meta content='#00B5F0' name='msapplication-TileColor'>
    <meta content='https://captainup.com/assets/logo/logo-500x500.png' name='msapplication-TileImage'>
    <link href='https://captainup.com/assets/logo/logo-500x500.png' rel='apple-touch-icon'>
    <!-- Fonts -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,700,300|Open+Sans+Condensed:300italic,300,700' rel='stylesheet' type='text/css'>
    <script src='//use.typekit.net/zsj7cik.js' type='text/javascript'></script>
    <script>
      try{Typekit.load();}catch(e){}
    </script>
    <!-- Stylesheets and code highlighting -->
    <link href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/default.min.css' rel='stylesheet'>
    <link href='/css/stylesheet.css' media='screen' rel='stylesheet' type='text/css'>
    <!-- Facebook Open Graph tags -->
    <meta content='Captain Up NodeJS Playground' property='og:title'>
    <meta content='website' property='og:type'>
    <meta content='https://nodejs.captainup.com/' property='og:url'>
    <meta content='https://captainup.com/assets/logo/logo-500x500.png' property='og:image'>
    <meta content='Captain Up' property='og:site_name'>
    <meta content='100000012316035' property='fb:admins'>
  </head>
  <body>
    <!-- Load the Facebook and Twitter JavaScript SDKs -->
    <div id='fb-root'>
      <script>
        (function(d, s, id) {
          var js, fjs = d.getElementsByTagName(s)[0];
          if (d.getElementById(id)) return;
          js = d.createElement(s); js.id = id;
          js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=274937649268398&version=v2.0";
          fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
      </script>
      <script>
        window.twttr=(function(d,s,id){var t,js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id)){return}js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);return window.twttr||(t={_e:[],ready:function(f){t._e.push(f)}})}(document,"script","twitter-wjs"));
      </script>
    </div>
    <!-- Top Menu -->
    <div id='menu'>
      <div class='content'>
        <div class='logo'>
          <a href='https://captainup.com' target='_blank'>
            <img class='cptup-logo-text' src='https://captainup.com/assets/splash/captain-head.png'>
          </a>
          <a class='captain-name' href='https://captainup.com/' target='_blank'>Captain Up</a>
        </div>
        <div class='nav'>
          <a href='https://github.com/captainup/captain-nodejs' target='_blank'>GitHub</a>
          <a href='https://captainup.com/help/' target='_blank'>Docs</a>
          <a href='http://captainup.com/blog/' target='_blank'>Blog</a>
          <a href='https://captainup.com/users/sign_in' target='_blank'>Sign In</a>
        </div>
        <a href='https://captainup.com/users/sign_up'>
          <div class='button green small signup'>SIGN UP</div>
        </a>
      </div>
    </div>
    <!-- Title section -->
    <div id='title-section'>
      <h1 id='title'>Captain Up NodeJS SDK</h1>
      <p id='explainer'>
        Everything that you need to incentivize and engage with your community, now available as an open-source SDK for NodeJS and Parse.
      </p>
      <button class='button hipster small' id='learn-more'>Learn more</button>
      <!-- Background Clouds -->
      <div class='graphics-container'>
      </div>
    </div>
    <!-- Main Content -->
    <div id='main-content'>
      <!-- Getting Started: Installation and Configuration -->
      <h2 class='first-title'>Getting Started</h2>
      <div class='content' id='container'>
        <div class='well'>
          <p>If you haven&#39;t done so yet, <a href="https://captainup.com/users/sign_up">sign up to Captain Up</a> (it&#39;s free!), check out <a href="https://captainup.com/features">all the features</a>, go over the <a href="https://captainup.com/help/api/reference/overview">API docs</a> and <a href="https://captainup.com/docs">guides</a> and <a href="https://captainup.com/help/getting-started/overview">configure your app</a> to setup the right incentives for your community actions and behavior.</p>
        </div>
        <h3>Install</h3>
        <ul>
        <li><strong>NodeJS</strong>: Install using <code>npm install captainup</code> or add <code>captainup</code> to your <code>package.json</code> dependencies.</li>
        <li><strong>Parse</strong>: Download the <code>captainup.parse.js</code> file from our <a href="https://github.com/captainup/captain-nodejs">GitHub repository</a> and copy it to your cloud code folder.</li>
        </ul>
        <h3>Configuration</h3>
        <ol>
        <li><p>Require the Captain Up module:</p>
        
        <ul>
        <li><strong>NodeJS</strong>: <code>var captain = require(&#39;captainup&#39;);</code></li>
        <li><strong>Parse</strong>: <code>var captain = require(&#39;cloud/captainup.parse.js&#39;);</code></li>
        </ul></li>
        <li><p>Initialize it with your API key and API secret:</p></li>
        </ol>
        <div class='code-example'>
          <pre class='code-highlight'><code class='javascript'>// Configure the Captain Up SDK&#x000A;captain.up({&#x000A;	// Your API Key&#x000A;	api_key: 'your-api-key',&#x000A;	// Your API Secret&#x000A;	api_secret: 'your-api-secret'&#x000A;});</code></pre>
        </div>
        <p class='well'>
          You can find your API key and secret key on the settings page in
          <a href='https://captainup.com/manage' target='_blank'>your Captain Up dashboard</a>
        </p>
      </div>
      <h2>Using the SDK resources</h2>
      <div class='content' id='container'>
        <div class='well'>
          <p><strong>ProTip</strong>: Looking for more sample code? The full source code for this site can be found in the <a href="https://github.com/captainup/captainup-nodejs/blob/master/samples">samples directory of the SDK&#39;s GitHub repository</a></p>
        </div>
        <!-- Service Status -->
        <h3>Status</h3>
        <p>At any time, you can retrieve the Captain Up service status. The response will contain an HTTP status <code>code</code> and a human-readable message with information on the service status. You can manually check the service status on our <a href="http://status.captainup.com/">status page</a>.</p>
        <div class='code-example'>
          <pre class='code-highlight'><code class='javascript'>captain.status().done(function(data) {&#x000A;	res.json(data);&#x000A;});</code></pre>
          <button class='button green small run-button' data-path='get-status'>run »</button>
        </div>
        <div class='response-snippet'>
          <h3>Response</h3>
          <div class='code-example code-response' id='get-status-response'>
            <pre class='code-highlight'><code class='javascript' data-path='get-status'></code></pre>
          </div>
        </div>
        <!-- Apps Resource -->
        <h3>Apps</h3>
        <p>An app holds all the information and seetings about the way Captain Up works in your site or app, including information about the app&#39;s levels, badges, action settings, design, text, and other options. Check out the full <a href="https://captainup.com/help/api/reference/apps">Apps API docs</a></p>
        <h4>Retrieving an app</h4>
        <div class='code-example'>
          <pre class='code-highlight'><code class='javascript'>captain.apps.get().done(function(data) {&#x000A;	res.json(data);&#x000A;});</code></pre>
          <button class='button green small run-button' data-path='get-app'>run »</button>
        </div>
        <div class='response-snippet'>
          <h3>Response</h3>
          <div class='code-example code-response' id='get-status-response'>
            <pre class='code-highlight'><code class='javascript' data-path='get-app'></code></pre>
          </div>
        </div>
        <!-- Users Resource -->
        <h3>Users</h3>
        <p>The user resource provides information about an app&#39;s users. Users share basic information and details such as the user name and the avatar image across all Captain Up apps, while the users&#39; progress in each app is completely independent. Check out the full <a href="https://captainup.com/help/api/reference/users">Users API docs</a> for more information.</p>
        <h4>Retrieving a user</h4>
        <div class='code-example'>
          <pre class='code-highlight'><code class='javascript'>captain.users.get('22161230313409025506561').done(function(data) {&#x000A;	res.json(data);&#x000A;});</code></pre>
          <button class='button green small run-button' data-path='get-user'>run »</button>
        </div>
        <div class='response-snippet'>
          <h3>Response</h3>
          <div class='code-example code-response' id='get-status-response'>
            <pre class='code-highlight'><code class='javascript' data-path='get-user'></code></pre>
          </div>
        </div>
        <!-- Actions Resource -->
        <h3>Actions</h3>
        <p>Actions are the backbone of the Captain Up platform. Apps can gain deep insights on their users based on their actions; segment, engage, interact and incentivize their users based on user actions, and incentivize users with points, badges, levels, rewards and messages for doing these actions.</p>
        
        <p>Captain Up supports completely dynamic actions, and every site and app can create and customize their own actions and how the experience evolves around them. <a href="https://captainup.com/help/getting-started/custom-actions-tutorial">Learn more about actions</a>.</p>
        <h4>Creating an action</h4>
        <div class='code-example'>
          <pre class='code-highlight'><code class='javascript'>captain.actions.create({&#x000A;	user: '22161230313409025506561',&#x000A;	action: {&#x000A;		name: 'test',&#x000A;		entity: {&#x000A;			type: 'SDK',&#x000A;			name: 'NodeJS SDK',&#x000A;			version: '1.0.0',&#x000A;			url: 'http://nodejs.captainup.com/'&#x000A;		}&#x000A;	}&#x000A;}).done(function(data) {&#x000A;	res.json(data);&#x000A;});</code></pre>
          <button class='button green small run-button' data-path='create-action'>run »</button>
        </div>
        <div class='response-snippet'>
          <h3>Response</h3>
          <div class='code-example code-response' id='get-status-response'>
            <pre class='code-highlight'><code class='javascript' data-path='create-action'></code></pre>
          </div>
        </div>
      </div>
      <!-- Working with the current user -->
      <h2>Working with the current user</h2>
      <div class='content' id='container'>
        <p>A Captain Up user ID is required in most requests that create or update users data and actions. In a lot of cases, you will want to use the current user&#39;s ID in these requests.</p>
        
        <p>The Captain Up SDK provides a convenience ExpressJS middleware that automatically loads the user ID from your site&#39;s cookies, verifies it has not been tampered with, and adds it to <code>req.captain.current_user</code> to be used in your requests. More information on how this process works (with code examples) can be found at the <a href="https://captainup.com/help/api/reference/actions">Actions API reference</a>.</p>
        
        <p>To enable this feature, you&#39;ll first need to configure the Captain Up client-side JavaScript SDK to update the user session:</p>
        <div class='code-example'>
          <pre class='code-highlight'><code class='javascript'>// Configuration options for the Captain Up JavaScript SDK:&#x000A;captain.up({&#x000A;	// Your API key&#x000A;	api_key: 'your_api_key',&#x000A;	// Enable server-side access to the user's session&#x000A;	cookie: true&#x000A;});</code></pre>
        </div>
        <p>After enabling this option, Captain Up will store the current user ID, alongside a secure signed version of it inside a cookie called <code>_cptup_sess</code> under your domain.</p>
        
        <p>To enable the Captain Up session middleware, add it right after the <code>express.cookieParser()</code> in your middlewares:</p>
        <div class='code-example'>
          <pre class='code-highlight'><code class='javascript'>// Cookie parsing middleware&#x000A;app.use(express.cookieParser());&#x000A;// Captain Up cookies middleware&#x000A;app.use(captain.middlewares.cookies());&#x000A;// Body parsing middleware&#x000A;app.use(express.bodyParser());</code></pre>
        </div>
        <p>That&#39;s it! You can now access <code>req.captain</code> and <code>req.captain.current_user</code> in all your request handlers. To check if there&#39;s currently a Captain Up user in the request, use <code>req.captain.current_user.exists()</code>. <code>req.captain</code> offers access to all the SDK functions, while <code>req.captain.current_user</code> allows you to send all the requests that involve the current user. Let&#39;s try it out. Run the code below, and after a few seconds you&#39;ll get several points and a new badge for being so awesome.</p>
        <div class='code-example'>
          <pre class='code-highlight'><code class='javascript'>// Create a new action for the current user&#x000A;req.captain.current_user.actions.create({&#x000A;	action: {&#x000A;		// We'll do a 'test' action&#x000A;		name: 'test',&#x000A;		// You're testing the NodeJS SDK&#x000A;		entity: {&#x000A;			type: 'SDK',&#x000A;			name: 'NodeJS SDK',&#x000A;			version: '1.0.0',&#x000A;			url: 'http://nodejs.captainup.com/',&#x000A;			awesome: 'very'&#x000A;		}&#x000A;	}&#x000A;}).done(function(data) {&#x000A;	res.json(data);&#x000A;})</code></pre>
          <button class='button green small run-button' data-path='current-player-create-action'>run »</button>
        </div>
        <div class='response-snippet'>
          <h3>Response</h3>
          <div class='code-example code-response' id='get-status-response'>
            <pre class='code-highlight'><code class='javascript' data-path='current-player-create-action'></code></pre>
          </div>
        </div>
      </div>
      <!-- Callbacks and Promises -->
      <h2>Callbacks and Promises</h2>
      <div class='content' id='container'>
        <p>All the SDK methods that send requests to the Captain Up platform are asynchronous. The SDK supports both NodeJS-style callbacks, and promises.</p>
        
        <h4>Callbacks</h4>
        
        <p>The last, optional, parameter each request method can receive is a callback function. The callback will be executed once data has returned from Captain Up, or when an error occurred.</p>
        
        <ul>
        <li><strong>NodeJS</strong> - The callback should be in the usual signature of <code>function(error, response)</code>.</li>
        <li><strong>Parse</strong> - In Parse, the callback is expected to be an object that contains two keys: <code>success</code> is the callback function to call after a successful request; <code>error</code> will be called if an error occurred.</li>
        </ul>
        <div class='code-example'>
          <pre class='code-highlight'><code class='javascript'>// NodeJS callbacks&#x000A;captain.status(function(error, response) {&#x000A;	// Will output: 'All is good'&#x000A;	console.log(response.message);&#x000A;});&#x000A;&#x000A;// Parse callbacks&#x000A;captain.status({&#x000A;	success: function(response) {&#x000A;		// Will output: 'All is good'&#x000A;		console.log(response.message);&#x000A;	},&#x000A;	error: function(error) {&#x000A;		// An error occurred...&#x000A;	}&#x000A;});</code></pre>
        </div>
        <h4>Promises</h4>
        
        <p>All the Captain Up request methods also return <a href="https://github.com/promises-aplus/promises-spec">A+ compliant promises</a>. In NodeJS, we use <a href="https://github.com/petkaantonov/bluebird">Bluebird promises</a>, and on Parse we use <a href="https://www.parse.com/docs/js/symbols/Parse.Promise.html">Parse.Promise</a>. The promises will be resolved with the response, or be rejected with an error:</p>
        <div class='code-example'></div>
        <pre class='code-highlight'><code class='javascript'>captain.status()&#x000A;.then(function(response) {&#x000A;	// Will output: 'All is good'&#x000A;	console.log(response.message);&#x000A;}, function(error) {&#x000A;	// An error occurred...&#x000A;});</code></pre>
      </div>
      <!-- Disqus Comments -->
      <h2>Questions? Feedback?</h2>
      <div class='content' id='container'>
        <div class='fb-like' data-action='like' data-href='https://nodejs.captainup.com/' data-layout='button_count' data-share='true' data-show-faces='false'></div>
        <a class='twitter-share-button' data-url='https://nodejs.captainup.com/' data-via='cptup' href='https://twitter.com/share'>Tweet</a>
        <div id='disqus_thread'></div>
        <script>
          var disqus_shortname = 'cptup';
          
          (function() {
          	var dsq = document.createElement('script');
          	dsq.type = 'text/javascript';
          	dsq.async = true;
          	dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          	(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
      </div>
    </div>
    <!-- Code Highlighting -->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/highlight.min.js'></script>
    <!-- jQuery -->
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>
    <!-- Include the Captain Up Embed SDK -->
    <div id='cptup-ready'></div>
    <script>
      window.captain = {up: function(fn) { captain.topics.push(fn) }, topics: []};
      captain.up({
      	// The Captain Up API key
      	api_key: '5413b72a73873a41f4000002',
      	// Enable server-side access to the user's session
      	cookie: true
      });
      
      (function() {
      	var cpt = document.createElement('script'); cpt.type = 'text/javascript'; cpt.async = true;
      	cpt.src = 'http' + (location.protocol == 'https:' ? 's' : '') + '://captainup.com/assets/embed.en.js';
      	(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(cpt);
      })();
    </script>
    <!-- JavaScript to run the playground -->
    <script>
      // Initialize Code Highlighting
      hljs.initHighlightingOnLoad();
      
      // Initializes the playground
      var initialize = function() {
      	$('body').on('click', '.run-button', function(e) {
      		// Grab a quick reference to the clicked run button
      		$el = $(e.currentTarget);
      		// Get the request URL path from the element's data attribute
      		path = $el.data('path');
      		// Send a JSON request
      		$.getJSON('/' + path, function(data) {
      			// Update the relevant response example with the response
      			// Get the relevant code response section
      			$response_example = $('.code-response code[data-path="' + path + '"]')
      			// and update its content (after clearing it) with the response as a
      			// properly formatted JSON
      			.empty().append(JSON.stringify(data, undefined, 2));
      			// Show the response snippet
      			$response_example.closest('.response-snippet').fadeIn(800);
      			// Re-initialize the code highlighting
      			hljs.highlightBlock($response_example[0]);
      		});
      	});
      
      	// Scroll the page when clicking on `#learn-more`
      	$('#learn-more').click(function() {
      		$('html,body').animate({scrollTop: 470}, 600);
      	});
      }
      
      // Initialize and start on DOM ready
      $(initialize)
    </script>
  </body>
</html>
